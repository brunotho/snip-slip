<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Snip slip</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.13.1/application.js' type='text/javascript'></script>
    <link href='./assets/0.13.1/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="icon" type="image/png" href="./assets/0.13.1/favicon_red.png" />
  </head>

  <body>
    <div id="loading">
      <img src="./assets/0.13.1/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2024-12-11T17:11:18+01:00">2024-12-11T17:11:18+01:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="red">
  5.87%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.06
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>25</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>682</b> relevant lines,
    <span class="green"><b>40</b> lines covered</span> and
    <span class="red"><b>642</b> lines missed. </span>
    (<span class="red">
  5.87%
</span>
)
  </div>



  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>

        </tr>
      </thead>
      <tbody>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4baa78ba760350fae85625f6d7709cc287e71f8e" class="src_link" title="app/channels/application_cable/channel.rb">app/channels/application_cable/channel.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#817ac8d3fc41ef3a743b4fc779fae5d5dd884733" class="src_link" title="app/channels/application_cable/connection.rb">app/channels/application_cable/connection.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3a29dcaf2c0e86c9d130581257ac3ce18ae6e63f" class="src_link" title="app/channels/game_session_channel.rb">app/channels/game_session_channel.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">38</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#76bad957a04548b84b1964db3b78a485821d209e" class="src_link" title="app/channels/notifications_channel.rb">app/channels/notifications_channel.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2458de67b15fe2f9fb4ff126360db2159a9a95eb" class="src_link" title="app/controllers/api/users_controller.rb">app/controllers/api/users_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">33</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#71205fa65a229950fe15e4241a4317320f4805fe" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">42</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#447dbf4feb9fed2544bfe3a372711c65d14e9b85" class="src_link" title="app/controllers/friendships_controller.rb">app/controllers/friendships_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">87</td>
            <td class="cell--number">69</td>
            <td class="cell--number">0</td>
            <td class="cell--number">69</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7db83aa478fa53f1b61c093925bff3c7216a4d23" class="src_link" title="app/controllers/game_sessions_controller.rb">app/controllers/game_sessions_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">179</td>
            <td class="cell--number">159</td>
            <td class="cell--number">0</td>
            <td class="cell--number">159</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f970fba2639d90299a6547942bf00abab5b2fa55" class="src_link" title="app/controllers/rounds_controller.rb">app/controllers/rounds_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">88</td>
            <td class="cell--number">77</td>
            <td class="cell--number">0</td>
            <td class="cell--number">77</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a24de10c3d7e560ec48f97718b7a456e78d1552d" class="src_link" title="app/controllers/snippets_controller.rb">app/controllers/snippets_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">43</td>
            <td class="cell--number">0</td>
            <td class="cell--number">43</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4e62d6c814a291dfd8c2f46050c7a563273b80cc" class="src_link" title="app/controllers/users_controller.rb">app/controllers/users_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#eb0fdc0a27e6019ba048b39a5e08e3d8b2a50490" class="src_link" title="app/controllers/welcome_controller.rb">app/controllers/welcome_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#afa442e72ce44727137313c3042eac43dbc2ddb1" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#35dfb4f442cebe6c5d5460a5f1b27c9cccd217db" class="src_link" title="app/helpers/spotify_auth_helper.rb">app/helpers/spotify_auth_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#34d1624e6f68835790b9e771bd7cc80febf49fba" class="src_link" title="app/helpers/welcome_helper.rb">app/helpers/welcome_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#466c8a5b738520d57c5b443116c6c5494348acb4" class="src_link" title="app/jobs/application_job.rb">app/jobs/application_job.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e58d0697019fd3f63b158ca1c5c0bc1c5d170c5e" class="src_link" title="app/mailers/application_mailer.rb">app/mailers/application_mailer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#79ae1458ebd28487b086f57f5703ee6bdf09b308" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#92c4bbb338593b103176badd7eb034f8ee2136cf" class="src_link" title="app/models/friendship.rb">app/models/friendship.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#581b0e4f0493d965a62e502a5117cf97e4ac2c10" class="src_link" title="app/models/game_session.rb">app/models/game_session.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">35</td>
            <td class="cell--number">27</td>
            <td class="cell--number">0</td>
            <td class="cell--number">27</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#48748a40a85831bd22b1b6d427e5a151a2df151c" class="src_link" title="app/models/game_session_participant.rb">app/models/game_session_participant.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b5e5f46b250c2a66a57403c96addfe02ccc7c327" class="src_link" title="app/models/lyric_snippet.rb">app/models/lyric_snippet.rb</a></td>
            <td class="red strong cell--number t-file__coverage">34.09 %</td>
            <td class="cell--number">88</td>
            <td class="cell--number">44</td>
            <td class="cell--number">15</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0.34</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cfe0e9864ca69d0995d6264279c3d8bf4f8aabc0" class="src_link" title="app/models/round.rb">app/models/round.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">11</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5f8a3276850c2b9c948b69c7087002e08cdae5cb" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
            <td class="red strong cell--number t-file__coverage">57.14 %</td>
            <td class="cell--number">65</td>
            <td class="cell--number">35</td>
            <td class="cell--number">20</td>
            <td class="cell--number">15</td>
            <td class="cell--number">0.57</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c57093f3dd034b29602fab2b15468b83b1454ef7" class="src_link" title="app/services/spotify_service.rb">app/services/spotify_service.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">54</td>
            <td class="cell--number">48</td>
            <td class="cell--number">0</td>
            <td class="cell--number">48</td>
            <td class="cell--number">0.00</td>

          </tr>

      </tbody>
    </table>
  </div>
</div>



          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent">
      <span class="red">
  0.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Controllers"></a>

  <div>
    <b>8</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>443</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>443</b> lines missed. </span>
    (<span class="red">
  0.0%
</span>
)
  </div>



  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>

        </tr>
      </thead>
      <tbody>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2458de67b15fe2f9fb4ff126360db2159a9a95eb" class="src_link" title="app/controllers/api/users_controller.rb">app/controllers/api/users_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">33</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#71205fa65a229950fe15e4241a4317320f4805fe" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">42</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#447dbf4feb9fed2544bfe3a372711c65d14e9b85" class="src_link" title="app/controllers/friendships_controller.rb">app/controllers/friendships_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">87</td>
            <td class="cell--number">69</td>
            <td class="cell--number">0</td>
            <td class="cell--number">69</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7db83aa478fa53f1b61c093925bff3c7216a4d23" class="src_link" title="app/controllers/game_sessions_controller.rb">app/controllers/game_sessions_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">179</td>
            <td class="cell--number">159</td>
            <td class="cell--number">0</td>
            <td class="cell--number">159</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f970fba2639d90299a6547942bf00abab5b2fa55" class="src_link" title="app/controllers/rounds_controller.rb">app/controllers/rounds_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">88</td>
            <td class="cell--number">77</td>
            <td class="cell--number">0</td>
            <td class="cell--number">77</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a24de10c3d7e560ec48f97718b7a456e78d1552d" class="src_link" title="app/controllers/snippets_controller.rb">app/controllers/snippets_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">43</td>
            <td class="cell--number">0</td>
            <td class="cell--number">43</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4e62d6c814a291dfd8c2f46050c7a563273b80cc" class="src_link" title="app/controllers/users_controller.rb">app/controllers/users_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#eb0fdc0a27e6019ba048b39a5e08e3d8b2a50490" class="src_link" title="app/controllers/welcome_controller.rb">app/controllers/welcome_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>

          </tr>

      </tbody>
    </table>
  </div>
</div>


          <div class="file_list_container" id="Channels">
  <h2>
    <span class="group_name">Channels</span>
    (<span class="covered_percent">
      <span class="red">
  0.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Channels"></a>

  <div>
    <b>4</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>48</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>48</b> lines missed. </span>
    (<span class="red">
  0.0%
</span>
)
  </div>



  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>

        </tr>
      </thead>
      <tbody>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4baa78ba760350fae85625f6d7709cc287e71f8e" class="src_link" title="app/channels/application_cable/channel.rb">app/channels/application_cable/channel.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#817ac8d3fc41ef3a743b4fc779fae5d5dd884733" class="src_link" title="app/channels/application_cable/connection.rb">app/channels/application_cable/connection.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3a29dcaf2c0e86c9d130581257ac3ce18ae6e63f" class="src_link" title="app/channels/game_session_channel.rb">app/channels/game_session_channel.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">38</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#76bad957a04548b84b1964db3b78a485821d209e" class="src_link" title="app/channels/notifications_channel.rb">app/channels/notifications_channel.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0.00</td>

          </tr>

      </tbody>
    </table>
  </div>
</div>


          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent">
      <span class="red">
  27.61%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.28
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Models"></a>

  <div>
    <b>7</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>134</b> relevant lines,
    <span class="green"><b>37</b> lines covered</span> and
    <span class="red"><b>97</b> lines missed. </span>
    (<span class="red">
  27.61%
</span>
)
  </div>



  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>

        </tr>
      </thead>
      <tbody>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#79ae1458ebd28487b086f57f5703ee6bdf09b308" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#92c4bbb338593b103176badd7eb034f8ee2136cf" class="src_link" title="app/models/friendship.rb">app/models/friendship.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#581b0e4f0493d965a62e502a5117cf97e4ac2c10" class="src_link" title="app/models/game_session.rb">app/models/game_session.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">35</td>
            <td class="cell--number">27</td>
            <td class="cell--number">0</td>
            <td class="cell--number">27</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#48748a40a85831bd22b1b6d427e5a151a2df151c" class="src_link" title="app/models/game_session_participant.rb">app/models/game_session_participant.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b5e5f46b250c2a66a57403c96addfe02ccc7c327" class="src_link" title="app/models/lyric_snippet.rb">app/models/lyric_snippet.rb</a></td>
            <td class="red strong cell--number t-file__coverage">34.09 %</td>
            <td class="cell--number">88</td>
            <td class="cell--number">44</td>
            <td class="cell--number">15</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0.34</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cfe0e9864ca69d0995d6264279c3d8bf4f8aabc0" class="src_link" title="app/models/round.rb">app/models/round.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">11</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5f8a3276850c2b9c948b69c7087002e08cdae5cb" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
            <td class="red strong cell--number t-file__coverage">57.14 %</td>
            <td class="cell--number">65</td>
            <td class="cell--number">35</td>
            <td class="cell--number">20</td>
            <td class="cell--number">15</td>
            <td class="cell--number">0.57</td>

          </tr>

      </tbody>
    </table>
  </div>
</div>


          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent">
      <span class="red">
  0.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Mailers"></a>

  <div>
    <b>1</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>4</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>4</b> lines missed. </span>
    (<span class="red">
  0.0%
</span>
)
  </div>



  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>

        </tr>
      </thead>
      <tbody>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e58d0697019fd3f63b158ca1c5c0bc1c5d170c5e" class="src_link" title="app/mailers/application_mailer.rb">app/mailers/application_mailer.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0.00</td>

          </tr>

      </tbody>
    </table>
  </div>
</div>


          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="yellow">
         1.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Helpers"></a>

  <div>
    <b>3</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>3</b> relevant lines,
    <span class="green"><b>3</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>



  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>

        </tr>
      </thead>
      <tbody>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#afa442e72ce44727137313c3042eac43dbc2ddb1" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#35dfb4f442cebe6c5d5460a5f1b27c9cccd217db" class="src_link" title="app/helpers/spotify_auth_helper.rb">app/helpers/spotify_auth_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>

          </tr>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#34d1624e6f68835790b9e771bd7cc80febf49fba" class="src_link" title="app/helpers/welcome_helper.rb">app/helpers/welcome_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>

          </tr>

      </tbody>
    </table>
  </div>
</div>


          <div class="file_list_container" id="Jobs">
  <h2>
    <span class="group_name">Jobs</span>
    (<span class="covered_percent">
      <span class="red">
  0.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Jobs"></a>

  <div>
    <b>1</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>2</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>2</b> lines missed. </span>
    (<span class="red">
  0.0%
</span>
)
  </div>



  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>

        </tr>
      </thead>
      <tbody>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#466c8a5b738520d57c5b443116c6c5494348acb4" class="src_link" title="app/jobs/application_job.rb">app/jobs/application_job.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0.00</td>

          </tr>

      </tbody>
    </table>
  </div>
</div>


          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Libraries"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>



  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>

        </tr>
      </thead>
      <tbody>

      </tbody>
    </table>
  </div>
</div>


          <div class="file_list_container" id="Ungrouped">
  <h2>
    <span class="group_name">Ungrouped</span>
    (<span class="covered_percent">
      <span class="red">
  0.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Ungrouped"></a>

  <div>
    <b>1</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>48</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>48</b> lines missed. </span>
    (<span class="red">
  0.0%
</span>
)
  </div>



  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>

        </tr>
      </thead>
      <tbody>

          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c57093f3dd034b29602fab2b15468b83b1454ef7" class="src_link" title="app/services/spotify_service.rb">app/services/spotify_service.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">54</td>
            <td class="cell--number">48</td>
            <td class="cell--number">0</td>
            <td class="cell--number">48</td>
            <td class="cell--number">0.00</td>

          </tr>

      </tbody>
    </table>
  </div>
</div>


      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.13.1<br/>
        using RSpec
      </div>

      <div class="source_files">

        <div class="source_table" id="4baa78ba760350fae85625f6d7709cc287e71f8e">
  <div class="header">
    <h3>app/channels/application_cable/channel.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">module ApplicationCable</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  class Channel &lt; ActionCable::Channel::Base</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="3">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="817ac8d3fc41ef3a743b4fc779fae5d5dd884733">
  <div class="header">
    <h3>app/channels/application_cable/connection.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">module ApplicationCable</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  class Connection &lt; ActionCable::Connection::Base</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="3">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="3a29dcaf2c0e86c9d130581257ac3ce18ae6e63f">
  <div class="header">
    <h3>app/channels/game_session_channel.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>34</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>34</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class GameSessionChannel &lt; ApplicationCable::Channel</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  def subscribed</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="3">




            <code class="ruby">    p &quot;game_session_channel.rb 🟢 session_id: #{params[:game_session_id]}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">    @game_session = GameSession.find(params[:game_session_id])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="5">




            <code class="ruby">    stream_for @game_session</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="6">




            <code class="ruby">    broadcast_player_joined</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="7">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="8">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="9">




            <code class="ruby">  def unsubscribed</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="10">




            <code class="ruby">    p &quot;game_session_channel.rb 🔴 session_id: #{params[:game_session_id]}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="11">




            <code class="ruby">    broadcast_player_left</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="12">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="13">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="14">




            <code class="ruby">  private</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="15">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="16">




            <code class="ruby">  def broadcast_player_joined</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="17">




            <code class="ruby">    ActionCable.server.broadcast(</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="18">




            <code class="ruby">      &quot;game_session_#{@game_session_id}&quot;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="19">




            <code class="ruby">      {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="20">




            <code class="ruby">        type: &quot;player_joined&quot;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="21">




            <code class="ruby">        player: {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="22">




            <code class="ruby">          id: current_user.id,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="23">




            <code class="ruby">          name: current_user.name,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="24">




            <code class="ruby">          rounds_played: 0,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="25">




            <code class="ruby">          successful_rounds_count: 0,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="26">




            <code class="ruby">          total_score: 0</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="27">




            <code class="ruby">        }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="28">




            <code class="ruby">      }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="29">




            <code class="ruby">    )</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="30">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="31">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="32">




            <code class="ruby">  def broadcast_player_left</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="33">




            <code class="ruby">    ActionCable.server.broadcast &quot;game_session_#{@game_session_id}&quot;, {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="34">




            <code class="ruby">      type: &quot;player_left&quot;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="35">




            <code class="ruby">      player_id: current_user.id</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="36">




            <code class="ruby">    }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="37">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="38">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="76bad957a04548b84b1964db3b78a485821d209e">
  <div class="header">
    <h3>app/channels/notifications_channel.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>6</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class NotificationsChannel &lt; ApplicationCable::Channel</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  def subscribed</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="3">




            <code class="ruby">    p &quot;notifications_channel.rb 🟢&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">    stream_from &quot;user_notifications&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="5">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="6">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="2458de67b15fe2f9fb4ff126360db2159a9a95eb">
  <div class="header">
    <h3>app/controllers/api/users_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>29</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>29</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class Api::UsersController &lt; ApplicationController</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  before_action :authenticate_user!</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="3">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">  def update</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="5">




            <code class="ruby">    if updating_sensitive_info?(user_params)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="6">




            <code class="ruby">      if current_user.valid_password?(params[:user][:current_password])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="7">




            <code class="ruby">        if current_user.update(user_params.except(:current_password))</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="8">




            <code class="ruby">          render json: current_user.as_json(only: [:name, :language])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="9">




            <code class="ruby">        else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="10">




            <code class="ruby">          render json: { errors: current_user.errors }, status: 422</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="11">




            <code class="ruby">        end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="12">




            <code class="ruby">      else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="13">




            <code class="ruby">        render json: { errors: { current_password: [&quot;is incorrect&quot;] } }, status: 422</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="14">




            <code class="ruby">      end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="15">




            <code class="ruby">    else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="16">




            <code class="ruby">      if current_user.update(user_params.except(:password, :password_confirmation, :current_password))</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="17">




            <code class="ruby">        render json: current_user.as_json(only: [:name, :language])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="18">




            <code class="ruby">      else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="19">




            <code class="ruby">        render json: { errors: current_user.errors }, status: 422</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="20">




            <code class="ruby">      end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="21">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="22">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="23">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="24">




            <code class="ruby">  private</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="25">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="26">




            <code class="ruby">  def user_params</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="27">




            <code class="ruby">    params.require(:user).permit(:name, :language, :password, :password_confirmation, :current_password)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="28">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="29">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="30">




            <code class="ruby">  def updating_sensitive_info?(params)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="31">




            <code class="ruby">    params[:password].present?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="32">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="33">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="71205fa65a229950fe15e4241a4317320f4805fe">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>31</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>31</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  include ActiveStorage::SetCurrent</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="3">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">  before_action :configure_permitted_paramters, if: :devise_controller?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="5">




            <code class="ruby">  before_action :store_user_location!, if: :storable_location?</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="6">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="7">




            <code class="ruby">  helper_method :current_game_session</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="8">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="9">




            <code class="ruby">  allow_browser versions: :modern</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="10">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="11">




            <code class="ruby">  protected</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="12">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="13">




            <code class="ruby">  def configure_permitted_paramters</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="14">




            <code class="ruby">    devise_parameter_sanitizer.permit(:sign_up, keys: [ :name, :language ])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="15">




            <code class="ruby">    devise_parameter_sanitizer.permit(:account_update, keys: [ :name, :language ])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="16">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="17">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="18">




            <code class="ruby">  private</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="19">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="20">




            <code class="ruby">  def store_user_location!</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="21">




            <code class="ruby">    Rails.logger.debug &quot;🎯 Attempting to store location: #{request.fullpath}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="22">




            <code class="ruby">    Rails.logger.debug &quot;🎯 Storable?: #{storable_location?}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="23">




            <code class="ruby">    store_location_for(:user, request.fullpath) if storable_location?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="24">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="25">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="26">




            <code class="ruby">  def storable_location?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="27">




            <code class="ruby">    request.get? &amp;&amp; !devise_controller? &amp;&amp; !request.xhr?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="28">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="29">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="30">




            <code class="ruby">  def after_sign_in_path_for(resource)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="31">




            <code class="ruby">    stored_path = stored_location_for(resource)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="32">




            <code class="ruby">    Rails.logger.debug &quot;🎯 After sign in - Stored path: #{stored_path}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="33">




            <code class="ruby">    stored_path || root_path</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="34">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="35">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="36">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="37">




            <code class="ruby">  def current_game_session</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="38">




            <code class="ruby">    if user_signed_in?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="39">




            <code class="ruby">      current_user.game_sessions.where(status: true).order(created_at: :desc).first</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="40">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="41">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="42">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="447dbf4feb9fed2544bfe3a372711c65d14e9b85">
  <div class="header">
    <h3>app/controllers/friendships_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>69</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>69</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class FriendshipsController &lt; ApplicationController</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  before_action :authenticate_user!</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="3">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">  def index</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="5">




            <code class="ruby">    @friendships_data = {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="6">




            <code class="ruby">      friends: current_user.friendships.accepted.map { |f| { id: f.id, name: f.friend.name, user_id: f.friend.id } },</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="7">




            <code class="ruby">      pending_requests: current_user.friendships.pending.map { |f| { id: f.id, name: f.friend.name, user_id: f.friend.id } },</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="8">




            <code class="ruby">      received_requests: Friendship.pending.where(friend: current_user).map { |f| { id: f.id, name: f.user.name, user_id: f.user.id } }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="9">




            <code class="ruby">    }</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="10">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="11">




            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="12">




            <code class="ruby">      format.html</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="13">




            <code class="ruby">      format.json { render json: @friendships_data }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="14">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="15">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="16">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="17">




            <code class="ruby">  def create</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="18">




            <code class="ruby">    friend = User.find(params[:friend_id])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="19">




            <code class="ruby">    friendship = current_user.send_friend_request(friend)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="20">




            <code class="ruby">    if friendship.persisted?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="21">




            <code class="ruby">      render json: friendship, status: 201</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="22">




            <code class="ruby">    else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="23">




            <code class="ruby">      render json: friendship.errors, status: 422</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="24">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="25">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="26">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="27">




            <code class="ruby">  def update</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="28">




            <code class="ruby">    friendship = Friendship.find(params[:id])</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="29">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="30">




            <code class="ruby">    p &quot;🤝 Friendship found:&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="31">




            <code class="ruby">    p friendship.inspect</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="32">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="33">




            <code class="ruby">    if friendship &amp;&amp; (friendship.user_id == current_user.id || friendship.friend_id == current_user.id)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="34">




            <code class="ruby">      case params[:status]</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="35">




            <code class="ruby">      when &quot;accepted&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="36">




            <code class="ruby">        if friendship.update(status: :accepted)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="37">




            <code class="ruby">          reverse_friendship = Friendship.find_or_initialize_by(user_id: friendship.friend_id, friend_id: friendship.user_id)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="38">




            <code class="ruby">          reverse_friendship.update(status: :accepted)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="39">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="40">




            <code class="ruby">          updated_data = {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="41">




            <code class="ruby">            friends: current_user.friendships.accepted.map { |f| { id: f.id, name: f.friend.name, user_id: f.friend.id } },</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="42">




            <code class="ruby">            pending_requests: current_user.friendships.pending.where(user_id: current_user.id).map { |f| { id: f.id, name: f.friend.name, user_id: f.friend.id } },</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="43">




            <code class="ruby">            received_requests: current_user.friendships.pending.where(friend_id: current_user.id).map { |f| { id: f.id, name: f.user.name, user_id: f.user.id } }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="44">




            <code class="ruby">          }</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="45">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="46">




            <code class="ruby">          render json: { success: true, message: &quot;Friend request accepted&quot;, updated_data: updated_data }, status: :ok</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="47">




            <code class="ruby">        else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="48">




            <code class="ruby">          render json: { error: &quot;Failed to accept friend request&quot; }, status: 422</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="49">




            <code class="ruby">        end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="50">




            <code class="ruby">      when &quot;declined&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="51">




            <code class="ruby">        if friendship.update(status: :declined)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="52">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="53">




            <code class="ruby">          updated_data = {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="54">




            <code class="ruby">            friends: current_user.friendships.accepted.map { |f| { id: f.id, name: f.friend.name, user_id: f.friend.id } },</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="55">




            <code class="ruby">            pending_requests: current_user.friendships.pending.where(user_id: current_user.id).map { |f| { id: f.id, name: f.friend.name, user_id: f.friend.id } },</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="56">




            <code class="ruby">            received_requests: current_user.friendships.pending.where(friend_id: current_user.id).map { |f| { id: f.id, name: f.user.name, user_id: f.user.id } }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="57">




            <code class="ruby">          }</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="58">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="59">




            <code class="ruby">          render json: { success: true, message: &quot;Friend request declined&quot;, updated_data: updated_data }, status: :ok</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="60">




            <code class="ruby">        else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="61">




            <code class="ruby">          render json: { error: &quot;Failed to decline friend request&quot; }, status: 422</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="62">




            <code class="ruby">        end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="63">




            <code class="ruby">      else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="64">




            <code class="ruby">        render json: { error: &quot;Invalid status&quot; }, status: 422</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="65">




            <code class="ruby">      end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="66">




            <code class="ruby">    else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="67">




            <code class="ruby">      render json: { error: &quot;Friendship not found or unauthorized&quot; }, status: 404</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="68">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="69">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="70">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="71">




            <code class="ruby">  def destroy</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="72">




            <code class="ruby">    friendship = Friendship.find(params[:id])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="73">




            <code class="ruby">    if friendship &amp;&amp; (friendship.user_id == current_user.id || friendship.friend_id == current_user.id)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="74">




            <code class="ruby">      friendship.destroy</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="75">




            <code class="ruby">      render json: { success: true }, status: :ok</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="76">




            <code class="ruby">      # respond_to do |format|</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="77">




            <code class="ruby">      #   format.html { redirect_to friendships_path, notice: &#39;Friend removed successfully.&#39; }</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="78">




            <code class="ruby">      #   format.json { render json: { success: true }, status: :ok }</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="79">




            <code class="ruby">      # end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="80">




            <code class="ruby">    else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="81">




            <code class="ruby">      render json: { error: &quot;Friendship not found or unauthorized :&lt;&quot; }, status: 422</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="82">




            <code class="ruby">      # respond_to do |format|</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="83">




            <code class="ruby">      #   format.html { redirect_to friendships_path, alert: &#39;Friendship not found.&#39; }</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="84">




            <code class="ruby">      #   format.json { render json: { error: &#39;Friendship not found&#39; }, status: :unprocessable_entity }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="85">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="86">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="87">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="7db83aa478fa53f1b61c093925bff3c7216a4d23">
  <div class="header">
    <h3>app/controllers/game_sessions_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>159</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>159</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class GameSessionsController &lt; ApplicationController</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  before_action :store_user_location!, if: :storable_location?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="3">




            <code class="ruby">  before_action :authenticate_user! #, only: [ :start_single_player ]</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">  before_action :set_game_session, only: [:show, :invite_friend, :leave_game]</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="5">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="6">




            <code class="ruby">  def show</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="7">




            <code class="ruby">    @game_session = GameSession.find(params[:id])</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="8">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="9">




            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="10">




            <code class="ruby">      format.html</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="11">




            <code class="ruby">      format.json { render json: game_session_data(@game_session) }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="12">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="13">




            <code class="ruby">  rescue ActiveRecord::RecordNotFound</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="14">




            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="15">




            <code class="ruby">      format.html { redirect_to root_path, alert: &quot;Game session not found&quot; }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="16">




            <code class="ruby">      format.json { render json: { error: &quot;Game session not found&quot; }, status: 404 }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="17">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="18">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="19">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="20">




            <code class="ruby">  def start_single_player</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="21">




            <code class="ruby">    ActiveRecord::Base.transaction do</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="22">




            <code class="ruby">      @game_session = GameSession.create!</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="23">




            <code class="ruby">      @game_session.game_session_participants.create!(user: current_user)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="24">




            <code class="ruby">      redirect_to snippets_path</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="25">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="26">




            <code class="ruby">  rescue ActiveRecord::RecordInvalid =&gt; e</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="27">




            <code class="ruby">    redirect_to root_path, alert: &quot;Failed to start singleplayer session: #{e.message}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="28">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="29">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="30">




            <code class="ruby">  def start_multiplayer</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="31">




            <code class="ruby">    ActiveRecord::Base.transaction do</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="32">




            <code class="ruby">      @game_session = GameSession.create!</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="33">




            <code class="ruby">      @game_session.game_session_participants.create!(user: current_user)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="34">




            <code class="ruby">      redirect_to invite_game_session_path(@game_session)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="35">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="36">




            <code class="ruby">  rescue ActiveRecord::RecordInvalid =&gt; e</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="37">




            <code class="ruby">    redirect_to root_path, alert: &quot;Failed to start multiplayer session: #{e.message}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="38">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="39">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="40">




            <code class="ruby">  def invite</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="41">




            <code class="ruby">    @game_session = GameSession.find(params[:id])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="42">




            <code class="ruby">  rescue</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="43">




            <code class="ruby">    redirect_to root_path, alert: &quot;Game session not found&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="44">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="45">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="46">




            <code class="ruby">  def invite_friend</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="47">




            <code class="ruby">    friend = User.find(params[:friend_id])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="48">




            <code class="ruby">    if current_user.invitable_friend?(friend)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="49">




            <code class="ruby">      broadcast_game_invitation(friend)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="50">




            <code class="ruby">      render json: { message: &quot;Friend invited successfully&quot; }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="51">




            <code class="ruby">    else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="52">




            <code class="ruby">      render json: { error: &quot;You can only invite friends with pending or accepted status&quot; }, status: 422</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="53">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="54">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="55">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="56">




            <code class="ruby">  def broadcast_game_invitation(user)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="57">




            <code class="ruby">    ActionCable.server.broadcast(</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="58">




            <code class="ruby">      &quot;user_notifications&quot;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="59">




            <code class="ruby">      {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="60">




            <code class="ruby">        type: &quot;game_invitation&quot;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="61">




            <code class="ruby">        game_session_id: @game_session.id,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="62">




            <code class="ruby">        player: {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="63">




            <code class="ruby">          id: user.id,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="64">




            <code class="ruby">          name: user.name</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="65">




            <code class="ruby">        },</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="66">




            <code class="ruby">        inviter: {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="67">




            <code class="ruby">          id: current_user.id,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="68">




            <code class="ruby">          name: current_user.name</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="69">




            <code class="ruby">        }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="70">




            <code class="ruby">      }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="71">




            <code class="ruby">    )</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="72">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="73">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="74">




            <code class="ruby">  def accept_invitation</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="75">




            <code class="ruby">    @game_session = GameSession.find(params[:id])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="76">




            <code class="ruby">    begin</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="77">




            <code class="ruby">      participant = @game_session.game_session_participants.create!(user: current_user)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="78">




            <code class="ruby">      broadcast_player_joined(current_user)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="79">




            <code class="ruby">      render json: {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="80">




            <code class="ruby">        message: &quot;Successfully joined game&quot;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="81">




            <code class="ruby">        redirect_url: invite_game_session_path(@game_session)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="82">




            <code class="ruby">      }, status: :ok</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="83">




            <code class="ruby">    rescue ActiveRecord::RecordInvalid =&gt; e</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="84">




            <code class="ruby">      render json: { error: e.message }, status: 422</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="85">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="86">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="87">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="88">




            <code class="ruby">  def start</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="89">




            <code class="ruby">    @game_session = GameSession.find(params[:id])</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="90">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="91">




            <code class="ruby">    if @game_session.game_session_participants.exists?(user: current_user)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="92">




            <code class="ruby">      @game_session.update!(started: true)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="93">




            <code class="ruby">      broadcast_game_start</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="94">




            <code class="ruby">      render json: { message: &quot;Game started successfully&quot; }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="95">




            <code class="ruby">    else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="96">




            <code class="ruby">      render json: { error: &quot;Not authorized to start this game&quot; }, status: :unauthorized</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="97">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="98">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="99">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="100">




            <code class="ruby">  def leave_game</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="101">




            <code class="ruby">    participant = @game_session.game_session_participants.find_by(user: current_user)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="102">




            <code class="ruby">    if participant</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="103">




            <code class="ruby">      participant.destroy</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="104">




            <code class="ruby">      default_remaining_rounds_to_failed</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="105">




            <code class="ruby">      broadcast_player_left(current_user)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="106">




            <code class="ruby">      render json: { message: &quot;Left the game successfully&quot; }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="107">




            <code class="ruby">    else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="108">




            <code class="ruby">      render json: { error: &quot;You are not a participant in this game&quot; }, status: 422</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="109">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="110">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="111">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="112">




            <code class="ruby">  private</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="113">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="114">




            <code class="ruby">  def set_game_session</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="115">




            <code class="ruby">    @game_session = current_user.game_sessions.find(params[:id])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="116">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="117">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="118">




            <code class="ruby">  def game_session_data(game_session)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="119">




            <code class="ruby">    first_participant = game_session.game_session_participants.order(:created_at).first</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="120">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="121">




            <code class="ruby">    {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="122">




            <code class="ruby">      game_session_id: game_session.id,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="123">




            <code class="ruby">      current_player_id: current_user.id,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="124">




            <code class="ruby">      current_player_name: current_user.name,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="125">




            <code class="ruby">      is_host: first_participant.user_id == current_user.id,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="126">




            <code class="ruby">      total_score: current_user.total_score,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="127">




            <code class="ruby">      successful_rounds_count: game_session.rounds.where(user: current_user, success: true).count,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="128">




            <code class="ruby">      rounds_played: game_session.rounds.where(user_id: current_user.id).count,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="129">




            <code class="ruby">      status: game_session.status,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="130">




            <code class="ruby">      round_history: [],</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="131">




            <code class="ruby">      players: game_session.game_session_participants.each_with_object({}) do |participant, hash|</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="132">




            <code class="ruby">        hash[participant.user.id] = {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="133">




            <code class="ruby">          id: participant.user.id,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="134">




            <code class="ruby">          name: participant.user.name,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="135">




            <code class="ruby">          total_score: participant.user.total_score,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="136">




            <code class="ruby">          successful_rounds_count: game_session.rounds.where(user: participant.user, success: true).count,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="137">




            <code class="ruby">          rounds_played: game_session.rounds.where(user_id: participant.user.id).count,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="138">




            <code class="ruby">          round_history: []</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="139">




            <code class="ruby">        }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="140">




            <code class="ruby">      end,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="141">




            <code class="ruby">      multiplayer: game_session.multiplayer?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="142">




            <code class="ruby">    }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="143">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="144">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="145">




            <code class="ruby">  def broadcast_player_joined(user)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="146">




            <code class="ruby">    GameSessionChannel.broadcast_to(@game_session, {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="147">




            <code class="ruby">      type: &quot;player_joined&quot;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="148">




            <code class="ruby">      player: { id: user.id, name: user.name }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="149">




            <code class="ruby">    })</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="150">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="151">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="152">




            <code class="ruby">  def broadcast_player_left</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="153">




            <code class="ruby">    GameSessionChannel.broadcast_to(@game_session, {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="154">




            <code class="ruby">      type: &quot;player_left&quot;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="155">




            <code class="ruby">      player: { id: user.id, name: user.name }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="156">




            <code class="ruby">    })</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="157">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="158">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="159">




            <code class="ruby">  def broadcast_game_start</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="160">




            <code class="ruby">    GameSessionChannel.broadcast_to(@game_session, {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="161">




            <code class="ruby">        type: &quot;game_start&quot;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="162">




            <code class="ruby">        game_session_id: @game_session.id</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="163">




            <code class="ruby">      })</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="164">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="165">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="166">




            <code class="ruby">  def default_remaining_rounds_to_failed</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="167">




            <code class="ruby">    remaining_rounds = 5 - @game_session.rounds.where(user: current_user).count</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="168">




            <code class="ruby">    dummy_snippet = LyricSnippet.find_by(artist: &quot;System&quot;, song: &quot;Failed Round&quot;)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="169">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="170">




            <code class="ruby">    remaining_rounds.times do</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="171">




            <code class="ruby">      @game_session.rounds.create!(</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="172">




            <code class="ruby">        user: current_user,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="173">




            <code class="ruby">        success: false,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="174">




            <code class="ruby">        score: 0,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="175">




            <code class="ruby">        lyric_snippet: dummy_snippet</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="176">




            <code class="ruby">      )</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="177">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="178">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="179">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="f970fba2639d90299a6547942bf00abab5b2fa55">
  <div class="header">
    <h3>app/controllers/rounds_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>77</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>77</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class RoundsController &lt; ApplicationController</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  before_action :authenticate_user!</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="3">




            <code class="ruby">  before_action :set_game_session</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="4">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="5">




            <code class="ruby">  def create</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="6">




            <code class="ruby">    unless @game_session.status?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="7">




            <code class="ruby">      render json: { error: &quot;Game session is already completed&quot; }, status: 403</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="8">




            <code class="ruby">      return</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="9">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="10">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="11">




            <code class="ruby">    @round = @game_session.rounds.build(round_params)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="12">




            <code class="ruby">    @round.user = current_user</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="13">




            <code class="ruby">    @round.difficulty = @round.lyric_snippet.difficulty</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="14">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="15">




            <code class="ruby">    if @round.save</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="16">




            <code class="ruby">      @game_session.check_game_session_status</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="17">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="18">




            <code class="ruby">      response_data = {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="19">




            <code class="ruby">        message: &quot;Round created successfully // MP:#{@game_session.multiplayer?}&quot;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="20">




            <code class="ruby">        round: {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="21">




            <code class="ruby">          id: @round.id,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="22">




            <code class="ruby">          success: @round.success,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="23">




            <code class="ruby">          score: @round.score,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="24">




            <code class="ruby">          lyric_snippet: {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="25">




            <code class="ruby">            snippet: @round.lyric_snippet.snippet</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="26">




            <code class="ruby">          }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="27">




            <code class="ruby">        },</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="28">




            <code class="ruby">        game_session: {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="29">




            <code class="ruby">          total_score: @game_session.total_score(current_user),</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="30">




            <code class="ruby">          rounds_played: @game_session.rounds.where(user: current_user).count,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="31">




            <code class="ruby">          status: @game_session.status,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="32">




            <code class="ruby">          player_game_over: player_game_over?,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="33">




            <code class="ruby">          game_over: !@game_session.status</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="34">




            <code class="ruby">        }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="35">




            <code class="ruby">      }</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="36">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="37">




            <code class="ruby">      if @game_session.multiplayer?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="38">




            <code class="ruby">        broadcast_data = {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="39">




            <code class="ruby">          type: &quot;round_completed&quot;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="40">




            <code class="ruby">          game_over: multiplayer_game_over?,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="41">




            <code class="ruby">          player: {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="42">




            <code class="ruby">            id: current_user.id,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="43">




            <code class="ruby">            name: current_user.name,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="44">




            <code class="ruby">            rounds_played: @game_session.rounds.where(user: current_user).count,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="45">




            <code class="ruby">            total_score: @game_session.total_score(current_user),</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="46">




            <code class="ruby">            round_history: @game_session.rounds.where(user_id: current_user.id).map do |round|</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="47">




            <code class="ruby">              {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="48">




            <code class="ruby">                success: round.success,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="49">




            <code class="ruby">                lyric_snippet: { snippet: round.lyric_snippet.snippet }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="50">




            <code class="ruby">              }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="51">




            <code class="ruby">            end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="52">




            <code class="ruby">          }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="53">




            <code class="ruby">        }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="54">




            <code class="ruby">        GameSessionChannel.broadcast_to(@game_session, broadcast_data)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="55">




            <code class="ruby">        ApplicationCable::Channel.broadcast_to(</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="56">




            <code class="ruby">          current_user,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="57">




            <code class="ruby">          broadcast_data</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="58">




            <code class="ruby">        )</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="59">




            <code class="ruby">      end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="60">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="61">




            <code class="ruby">      render json: response_data, status: 201</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="62">




            <code class="ruby">    else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="63">




            <code class="ruby">      render json: { errors: @round.errors.full_messages }, status: 4222</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="64">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="65">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="66">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="67">




            <code class="ruby">  private</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="68">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="69">




            <code class="ruby">  def set_game_session</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="70">




            <code class="ruby">    @game_session = current_user.game_sessions.find(params[:game_session_id])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="71">




            <code class="ruby">  rescue ActiveRecord::RecordNotFound</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="72">




            <code class="ruby">    render json: { error: &quot;Game session not found&quot; }, status: 404</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="73">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="74">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="75">




            <code class="ruby">  def round_params</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="76">




            <code class="ruby">    params.require(:round).permit(:lyric_snippet_id, :success)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="77">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="78">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="79">




            <code class="ruby">  def player_game_over?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="80">




            <code class="ruby">    @game_session.player_completed?(current_user)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="81">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="82">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="83">




            <code class="ruby">  def multiplayer_game_over?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="84">




            <code class="ruby">    @game_session.game_session_participants.all? { |participant|</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="85">




            <code class="ruby">      @game_session.player_completed?(participant.user)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="86">




            <code class="ruby">    }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="87">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="88">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="a24de10c3d7e560ec48f97718b7a456e78d1552d">
  <div class="header">
    <h3>app/controllers/snippets_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>43</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>43</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class SnippetsController &lt; ApplicationController</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  before_action :authenticate_user!, except: [ :index, :fetch_snippets ]</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="3">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">  def test</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="5">




            <code class="ruby">    @lyric_snippet = LyricSnippet.first</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="6">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="7">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="8">




            <code class="ruby">  def index</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="9">




            <code class="ruby">    @game_session = current_game_session</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="10">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="11">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="12">




            <code class="ruby">  def new</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="13">




            <code class="ruby">    @lyric_snippet = LyricSnippet.new</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="14">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="15">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="16">




            <code class="ruby">  def create</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="17">




            <code class="ruby">    @lyric_snippet = LyricSnippet.new(snippet_params)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="18">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="19">




            <code class="ruby">    if @lyric_snippet.save</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="20">




            <code class="ruby">      @snippet_data = @lyric_snippet.as_json.merge(</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="21">




            <code class="ruby">        image_url: @lyric_snippet.image.url</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="22">




            <code class="ruby">      )</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="23">




            <code class="ruby">      render :thank_you</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="24">




            <code class="ruby">    else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="25">




            <code class="ruby">      render :new, status: 422</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="26">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="27">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="28">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="29">




            <code class="ruby">  def fetch_snippets</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="30">




            <code class="ruby">    user_language = current_user&amp;.language || &quot;English&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="31">




            <code class="ruby">    random_ids = LyricSnippet</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="32">




            <code class="ruby">                .where.not(snippet: &quot;Dummy snippet for failed rounds&quot;)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="33">




            <code class="ruby">                .where(language: user_language)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="34">




            <code class="ruby">                # .where(artist: &quot;Arctic Monkeys&quot;)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="35">




            <code class="ruby">                .pluck(:id)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="36">




            <code class="ruby">                .sample(20)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="37">




            <code class="ruby">    snippets = LyricSnippet</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="38">




            <code class="ruby">                .where(id: random_ids)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="39">




            <code class="ruby">                .sample(4)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="40">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="41">




            <code class="ruby">    render json: snippets.map { |snippet|</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="42">




            <code class="ruby">      snippet.as_json.merge({</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="43">




            <code class="ruby">        image_url: snippet.image.attached? ? snippet.image.url : nil</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="44">




            <code class="ruby">      })</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="45">




            <code class="ruby">    }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="46">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="47">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="48">




            <code class="ruby">  private</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="49">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="50">




            <code class="ruby">  def snippet_params</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="51">




            <code class="ruby">    params.require(:lyric_snippet).permit(:snippet, :artist, :song, :difficulty, :language)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="52">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="53">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="4e62d6c814a291dfd8c2f46050c7a563273b80cc">
  <div class="header">
    <h3>app/controllers/users_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>31</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>31</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class UsersController &lt; ApplicationController</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  before_action :authenticate_user!, except: [:search]</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="3">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">  def show</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="5">




            <code class="ruby">    @user = current_user</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="6">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="7">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="8">




            <code class="ruby">  def edit</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="9">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="10">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="11">




            <code class="ruby">  def update</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="12">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="13">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="14">




            <code class="ruby">  def search</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="15">




            <code class="ruby">    Rails.logger.debug &quot;Search action called&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="16">




            <code class="ruby">    Rails.logger.debug &quot;Search params: #{params.inspect}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="17">




            <code class="ruby">    query = params[:q].to_s.strip</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="18">




            <code class="ruby">    Rails.logger.debug &quot;Query: #{query}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="19">




            <code class="ruby">    if query.length &lt; 2</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="20">




            <code class="ruby">      Rails.logger.debug &quot;Query too short&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="21">




            <code class="ruby">      render json: { error: &quot;Search term must be at least 2 characters long&quot; }, status: :unprocessable_entity</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="22">




            <code class="ruby">      return</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="23">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="24">




            <code class="ruby">    @users = User.where(&quot;name ILIKE :query OR email ILIKE :query&quot;, query: &quot;%#{query}%&quot;).limit(10)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="25">




            <code class="ruby">    Rails.logger.debug &quot;Found users: #{@users.inspect}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="26">




            <code class="ruby">    render json: @users.as_json(only: [:id, :name, :email])</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="27">




            <code class="ruby">  rescue =&gt; e</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="28">




            <code class="ruby">    Rails.logger.error &quot;Search error: #{e.message}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="29">




            <code class="ruby">    Rails.logger.error e.backtrace.join(&quot;\n&quot;)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="30">




            <code class="ruby">    render json: { error: &quot;An error occurred during search&quot; }, status: :internal_server_error</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="31">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="32">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="33">




            <code class="ruby">  def test</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="34">




            <code class="ruby">    render json: { message: &quot;Test successful&quot; }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="35">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="36">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="eb0fdc0a27e6019ba048b39a5e08e3d8b2a50490">
  <div class="header">
    <h3>app/controllers/welcome_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class WelcomeController &lt; ApplicationController</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  def home</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="3">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="afa442e72ce44727137313c3042eac43dbc2ddb1">
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="covered" data-hits="1" data-linenumber="1">

              <span class="hits">1</span>




            <code class="ruby">module ApplicationHelper</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="2">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="35dfb4f442cebe6c5d5460a5f1b27c9cccd217db">
  <div class="header">
    <h3>app/helpers/spotify_auth_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="covered" data-hits="1" data-linenumber="1">

              <span class="hits">1</span>




            <code class="ruby">module SpotifyAuthHelper</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="2">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="34d1624e6f68835790b9e771bd7cc80febf49fba">
  <div class="header">
    <h3>app/helpers/welcome_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="covered" data-hits="1" data-linenumber="1">

              <span class="hits">1</span>




            <code class="ruby">module WelcomeHelper</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="2">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="466c8a5b738520d57c5b443116c6c5494348acb4">
  <div class="header">
    <h3>app/jobs/application_job.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class ApplicationJob &lt; ActiveJob::Base</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="2">




            <code class="ruby">  # Automatically retry jobs that encountered a deadlock</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="3">




            <code class="ruby">  # retry_on ActiveRecord::Deadlocked</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="4">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="5">




            <code class="ruby">  # Most jobs are safe to ignore if the underlying records are no longer available</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="6">




            <code class="ruby">  # discard_on ActiveJob::DeserializationError</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="7">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="e58d0697019fd3f63b158ca1c5c0bc1c5d170c5e">
  <div class="header">
    <h3>app/mailers/application_mailer.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class ApplicationMailer &lt; ActionMailer::Base</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  default from: &quot;from@example.com&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="3">




            <code class="ruby">  layout &quot;mailer&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="79ae1458ebd28487b086f57f5703ee6bdf09b308">
  <div class="header">
    <h3>app/models/application_record.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="covered" data-hits="1" data-linenumber="1">

              <span class="hits">1</span>




            <code class="ruby">class ApplicationRecord &lt; ActiveRecord::Base</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="2">

              <span class="hits">1</span>




            <code class="ruby">  primary_abstract_class</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="3">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="92c4bbb338593b103176badd7eb034f8ee2136cf">
  <div class="header">
    <h3>app/models/friendship.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>12</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>12</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class Friendship &lt; ApplicationRecord</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="3">




            <code class="ruby">  belongs_to :friend, class_name: &quot;User&quot;</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="4">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="5">




            <code class="ruby">  enum status: { pending: 0, accepted: 1, declined: 2 }</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="6">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="7">




            <code class="ruby">  scope :declined, -&gt; { where(status: :declined) }</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="8">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="9">




            <code class="ruby">  validates :user_id, uniqueness: { scope: :friend_id }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="10">




            <code class="ruby">  validate :not_self</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="11">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="12">




            <code class="ruby">  private</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="13">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="14">




            <code class="ruby">  def not_self</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="15">




            <code class="ruby">    erros.add(:friend, &quot;can&#39;t be the same as the user&quot;) if user_id == friend_id</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="16">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="17">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="581b0e4f0493d965a62e502a5117cf97e4ac2c10">
  <div class="header">
    <h3>app/models/game_session.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>27</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>27</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class GameSession &lt; ApplicationRecord</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  has_many :rounds, dependent: :destroy</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="3">




            <code class="ruby">  has_many :game_session_participants, dependent: :destroy</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">  has_many :users, through: :game_session_participants</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="5">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="6">




            <code class="ruby">  before_validation :set_default_status, on: :create</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="7">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="8">




            <code class="ruby">  validates :status, inclusion: { in: [ true, false ] }</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="9">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="10">




            <code class="ruby">  def check_game_session_status</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="11">




            <code class="ruby">    if multiplayer?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="12">




            <code class="ruby">      update(status: false) if game_session_participants.all? { |participant| player_completed?(participant.user) }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="13">




            <code class="ruby">    else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="14">




            <code class="ruby">      update(status: false) if player_completed?(users.first)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="15">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="16">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="17">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="18">




            <code class="ruby">  def player_completed?(user)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="19">




            <code class="ruby">    rounds.where(user: user).count &gt;= 5</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="20">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="21">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="22">




            <code class="ruby">  def total_score(user)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="23">




            <code class="ruby">    rounds.where(user: user).sum(&amp;:score)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="24">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="25">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="26">




            <code class="ruby">  def multiplayer?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="27">




            <code class="ruby">    game_session_participants.count &gt; 1</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="28">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="29">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="30">




            <code class="ruby">  private</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="31">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="32">




            <code class="ruby">  def set_default_status</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="33">




            <code class="ruby">    self.status = true</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="34">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="35">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="48748a40a85831bd22b1b6d427e5a151a2df151c">
  <div class="header">
    <h3>app/models/game_session_participant.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>5</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class GameSessionParticipant &lt; ApplicationRecord</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  belongs_to :game_session</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="3">




            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="4">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="5">




            <code class="ruby">  validates :user_id, uniqueness: { scope: :game_session_id, message: &quot;user already in this session&quot; }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="6">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="b5e5f46b250c2a66a57403c96addfe02ccc7c327">
  <div class="header">
    <h3>app/models/lyric_snippet.rb</h3>
    <h4>
      <span class="red">
  34.09%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>44</b> relevant lines.
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>29</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="covered" data-hits="1" data-linenumber="1">

              <span class="hits">1</span>




            <code class="ruby">class LyricSnippet &lt; ApplicationRecord</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="2">

              <span class="hits">1</span>




            <code class="ruby">  has_many :rounds, dependent: :destroy</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="3">

              <span class="hits">1</span>




            <code class="ruby">  has_one_attached :image</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="4">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="5">

              <span class="hits">1</span>




            <code class="ruby">  validates :snippet, presence: true</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="6">

              <span class="hits">1</span>




            <code class="ruby">  validates :artist, presence: true</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="7">

              <span class="hits">1</span>




            <code class="ruby">  validates :song, presence: true</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="8">

              <span class="hits">1</span>




            <code class="ruby">  validates :difficulty, presence: true, inclusion: { in: 0..1000 }</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="9">

              <span class="hits">1</span>




            <code class="ruby">  validates :language, inclusion: { in: %w[English German] }</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="10">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="11">

              <span class="hits">1</span>




            <code class="ruby">  def self.languages</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="12">




            <code class="ruby">    validators_on(:language).first.options[:in]</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="13">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="14">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="15">

              <span class="hits">1</span>




            <code class="ruby">  before_save :attach_album_cover</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="16">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="17">

              <span class="hits">1</span>




            <code class="ruby">  private</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="18">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="19">

              <span class="hits">1</span>




            <code class="ruby">  def attach_album_cover</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="20">




            <code class="ruby">    artist_name = artist</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="21">




            <code class="ruby">    song_name = song</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="22">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="23">




            <code class="ruby">    image_url = find_best_album_match(spotify_api_call(artist_name, song_name), artist_name)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="24">




            <code class="ruby">    # return unless image_url</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="25">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="26">




            <code class="ruby">    p &quot;IMAGE_URL:&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="27">




            <code class="ruby">    p image_url</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="28">




            <code class="ruby">    p &quot;😎😋😊😎😋 END&quot;</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="29">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="30">




            <code class="ruby">    if image_url</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="31">




            <code class="ruby">      downloaded_image = URI.open(image_url)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="32">




            <code class="ruby">      image.attach(</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="33">




            <code class="ruby">        io: downloaded_image,</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="34">




            <code class="ruby">        filename: &quot;#{artist_name}_#{song_name}.jpg&quot;</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="35">




            <code class="ruby">      )</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="36">




            <code class="ruby">    else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="37">




            <code class="ruby">      default_image = File.open(Rails.root.join(&quot;app/assets/images/placeholder_album_cover.jpg&quot;))</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="38">




            <code class="ruby">      image.attach(</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="39">




            <code class="ruby">        io: default_image,</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="40">




            <code class="ruby">        filename: &quot;default_album.jpg&quot;</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="41">




            <code class="ruby">      )</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="42">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="43">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="44">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="45">

              <span class="hits">1</span>




            <code class="ruby">  def normalize_artist_name(name)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="46">




            <code class="ruby">    # add äö!`^ etc</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="47">




            <code class="ruby">    name.downcase.gsub(/[^a-z0-9\s]/i, &quot;&quot;).strip</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="48">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="49">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="50">

              <span class="hits">1</span>




            <code class="ruby">  def find_best_album_match(response, artist_name)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="51">




            <code class="ruby">    albums = response.dig(&quot;albums&quot;, &quot;items&quot;)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="52">




            <code class="ruby">    return nil unless albums&amp;.any?</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="53">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="54">




            <code class="ruby">    best_match = albums.find do |album|</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="55">




            <code class="ruby">      album[&quot;album_type&quot;] == &quot;album&quot; &amp;&amp;</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="56">




            <code class="ruby">      album[&quot;artists&quot;].any? do |artist|</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="57">




            <code class="ruby">        normalize_artist_name(artist[&quot;name&quot;]) == normalize_artist_name(artist_name)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="58">




            <code class="ruby">      end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="59">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="60">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="61">




            <code class="ruby">    best_match&amp;.dig(&quot;images&quot;, 0, &quot;url&quot;)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="62">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="63">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="64">

              <span class="hits">1</span>




            <code class="ruby">  def spotify_api_call(artist_name, song_name)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="65">




            <code class="ruby">    token = SpotifyService.get_access_token</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="66">




            <code class="ruby">    url = &quot;https://api.spotify.com/v1/search?q=20track%3A#{song_name.downcase}%2520artist%3A#{artist_name.downcase}&amp;type=album&quot;</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="67">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="68">




            <code class="ruby">    response = HTTParty.get(</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="69">




            <code class="ruby">      url,</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="70">




            <code class="ruby">      headers: {</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="71">




            <code class="ruby">        &quot;Authorization&quot; =&gt; &quot;Bearer #{token}&quot;</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="72">




            <code class="ruby">      }</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="73">




            <code class="ruby">    )</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="74">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="75">




            <code class="ruby">    p &quot;🥰🥰🥰🥰🥰🥰🥰🥰🥰🥰🥰🥰🥰🥰🥰🥰🥰 START #{artist_name} -- #{song_name}&quot;</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="76">




            <code class="ruby">    # p &quot;Full URL with query: #{response.request.last_uri}&quot;</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="77">




            <code class="ruby">    # p &quot;Base URI: #{response.request.uri}&quot;</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="78">




            <code class="ruby">    # p &quot;Path: #{response.request.path}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="79">




            <code class="ruby">    p &quot;Query string: #{response.request.uri.query}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="80">




            <code class="ruby">    p &quot;HTT🥳 encoded params: #{URI.decode_www_form(response.request.uri.query).to_h}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="81">




            <code class="ruby">    p &quot;😶 full response START:&quot;</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="82">




            <code class="ruby">    # p response</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="83">




            <code class="ruby">    puts JSON.pretty_generate(response.parsed_response)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="84">




            <code class="ruby">    p &quot;😶 full response END&quot;</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="85">




            <code class="ruby">    # response[&quot;albums&quot;][&quot;items&quot;][0][&quot;images&quot;][0][&quot;url&quot;]</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="86">




            <code class="ruby">    response</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="87">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="88">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="cfe0e9864ca69d0995d6264279c3d8bf4f8aabc0">
  <div class="header">
    <h3>app/models/round.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class Round &lt; ApplicationRecord</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  belongs_to :lyric_snippet</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="3">




            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">  belongs_to :game_session</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="5">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="6">




            <code class="ruby">  validates :success, inclusion: { in: [ true, false ] }</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="7">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="8">




            <code class="ruby">  def score</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="9">




            <code class="ruby">    success ? difficulty : 0</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="10">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="11">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="5f8a3276850c2b9c948b69c7087002e08cdae5cb">
  <div class="header">
    <h3>app/models/user.rb</h3>
    <h4>
      <span class="red">
  57.14%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>35</b> relevant lines.
      <span class="green"><b>20</b> lines covered</span> and
      <span class="red"><b>15</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="covered" data-hits="1" data-linenumber="1">

              <span class="hits">1</span>




            <code class="ruby">class User &lt; ApplicationRecord</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="2">




            <code class="ruby">  # Include default devise modules. Others available are:</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="3">




            <code class="ruby">  # :confirmable, :lockable, :timeoutable, :trackable and :omniauthable</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="4">

              <span class="hits">1</span>




            <code class="ruby">  devise :database_authenticatable, :registerable,</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="5">




            <code class="ruby">        :recoverable, :rememberable, :validatable</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="6">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="7">

              <span class="hits">1</span>




            <code class="ruby">  has_many :game_session_participants, dependent: :destroy</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="8">

              <span class="hits">1</span>




            <code class="ruby">  has_many :game_sessions, through: :game_session_participants</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="9">

              <span class="hits">1</span>




            <code class="ruby">  has_many :rounds, dependent: :destroy</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="10">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="11">

              <span class="hits">1</span>




            <code class="ruby">  validate :name_presence_and_length</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="12">

              <span class="hits">1</span>




            <code class="ruby">  validate :language_presence_and_inclusion</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="13">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="14">




            <code class="ruby">  # Updated friendship associations</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="15">

              <span class="hits">1</span>




            <code class="ruby">  has_many :friendships, dependent: :destroy</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="16">

              <span class="hits">1</span>




            <code class="ruby">  has_many :friends, -&gt; { where(friendships: { status: :accepted }) }, through: :friendships, source: :friend</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="17">

              <span class="hits">1</span>




            <code class="ruby">  has_many :pending_sent_requests, -&gt; { where(status: :pending) }, class_name: &#39;Friendship&#39;, foreign_key: &#39;user_id&#39;</code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="18">

              <span class="hits">1</span>




            <code class="ruby">  has_many :pending_received_requests, -&gt; { where(status: :pending) }, class_name: &#39;Friendship&#39;, foreign_key: &#39;friend_id&#39;</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="19">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="20">

              <span class="hits">1</span>




            <code class="ruby">  def send_friend_request(friend)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="21">




            <code class="ruby">    friendships.create(friend: friend, status: :pending)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="22">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="23">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="24">

              <span class="hits">1</span>




            <code class="ruby">  def accept_friend_request(friendship)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="25">




            <code class="ruby">    friendship.update(status: :accepted) if pending_received_requests.include?(friendship)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="26">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="27">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="28">

              <span class="hits">1</span>




            <code class="ruby">  def decline_friend_request(friendship)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="29">




            <code class="ruby">    friendship.destroy if pending_received_requests.include?(friendship)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="30">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="31">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="32">

              <span class="hits">1</span>




            <code class="ruby">  def remove_friend(friend)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="33">




            <code class="ruby">    friendship = friendships.find_by(friend: friend)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="34">




            <code class="ruby">    reverse_friendship = friend.friendships.find_by(friend: self)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="35">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="36">




            <code class="ruby">    friendship.destroy if friendship</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="37">




            <code class="ruby">    reverse_friendship.destroy if reverse_friendship</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="38">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="39">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="40">

              <span class="hits">1</span>




            <code class="ruby">  def invitable_friend?(friend)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="41">




            <code class="ruby">    friendships.where(friend: friend, status: [:pending, :accepted]).exists?</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="42">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="43">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="44">

              <span class="hits">1</span>




            <code class="ruby">  def total_score</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="45">




            <code class="ruby">    if (session = game_sessions.last)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="46">




            <code class="ruby">      session.rounds.where(user_id: id).map(&amp;:score).compact.sum</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="47">




            <code class="ruby">    else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="48">




            <code class="ruby">      0</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="49">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="50">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="51">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="52">

              <span class="hits">1</span>




            <code class="ruby">  private</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="53">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="54">

              <span class="hits">1</span>




            <code class="ruby">  def name_presence_and_length</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="55">




            <code class="ruby">    if name.blank? || name.length &lt; 2</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="56">




            <code class="ruby">      errors.add(:name, &quot;must be at least 2 characters long&quot;)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="57">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="58">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="59">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="covered" data-hits="1" data-linenumber="60">

              <span class="hits">1</span>




            <code class="ruby">  def language_presence_and_inclusion</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="61">




            <code class="ruby">    if language.blank? || !LyricSnippet.languages.include?(language)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="62">




            <code class="ruby">      errors.add(:language, &quot;must be selected&quot;)</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="63">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="64">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="65">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


        <div class="source_table" id="c57093f3dd034b29602fab2b15468b83b1454ef7">
  <div class="header">
    <h3>app/services/spotify_service.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>



    <div class="t-line-summary">
      <b>48</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>48</b> lines missed.</span>
    </div>



  </div>

  <pre>
    <ol>

        <div>
          <li class="missed" data-hits="0" data-linenumber="1">




            <code class="ruby">class SpotifyService</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="2">




            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="3">




            <code class="ruby">    def refresh_token</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="4">




            <code class="ruby">      response = HTTParty.post(&#39;https://accounts.spotify.com/api/token&#39;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="5">




            <code class="ruby">        body: {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="6">




            <code class="ruby">          grant_type: &#39;refresh_token&#39;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="7">




            <code class="ruby">          refresh_token: ENV[&#39;SPOTIFY_REFRESH_TOKEN&#39;]</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="8">




            <code class="ruby">        },</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="9">




            <code class="ruby">        headers: {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="10">




            <code class="ruby">          &#39;Authorization&#39; =&gt; &quot;Basic #{Base64.strict_encode64(&quot;#{ENV[&#39;SPOTIFY_CLIENT_ID&#39;]}:#{ENV[&#39;SPOTIFY_CLIENT_SECRET&#39;]}&quot;)}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="11">




            <code class="ruby">        }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="12">




            <code class="ruby">      )</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="13">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="14">




            <code class="ruby">      if response.success?</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="15">




            <code class="ruby">        Rails.cache.write(&#39;spotify_access_token&#39;, response[&#39;access_token&#39;], expires_in: 1.hour)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="16">




            <code class="ruby">        response[&#39;access_token&#39;]</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="17">




            <code class="ruby">      else</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="18">




            <code class="ruby">        raise &quot;Failed to refresh token: #{response.body}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="19">




            <code class="ruby">      end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="20">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="21">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="22">




            <code class="ruby">    def get_access_token</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="23">




            <code class="ruby">      cached_token = Rails.cache.read(&#39;spotify_access_token&#39;)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="24">




            <code class="ruby">      return cached_token if cached_token.present?</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="25">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="26">




            <code class="ruby">      refresh_token</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="27">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="28">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="29">




            <code class="ruby">    def make_api_request(endpoint)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="30">




            <code class="ruby">      token = get_access_token</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="31">




            <code class="ruby">      response = HTTParty.get(</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="32">




            <code class="ruby">        &quot;https://api.spotify.com/v1/#{endpoint}&quot;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="33">




            <code class="ruby">        headers: {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="34">




            <code class="ruby">          &#39;Authorization&#39; =&gt; &quot;Bearer #{token}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="35">




            <code class="ruby">        }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="36">




            <code class="ruby">      )</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="37">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="38">




            <code class="ruby">      if response.code == 401</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="39">




            <code class="ruby">        token = refresh_token</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="40">




            <code class="ruby">        response = HTTParty.get(</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="41">




            <code class="ruby">          &quot;https://api.spotify.com/v1/#{endpoint}&quot;,</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="42">




            <code class="ruby">          headers: {</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="43">




            <code class="ruby">            &#39;Authorization&#39; =&gt; &quot;Bearer #{token}&quot;</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="44">




            <code class="ruby">          }</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="45">




            <code class="ruby">        )</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="46">




            <code class="ruby">      end</code>
          </li>
        </div>

        <div>
          <li class="never" data-hits="" data-linenumber="47">




            <code class="ruby"></code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="48">




            <code class="ruby">      response</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="49">




            <code class="ruby">    rescue =&gt; e</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="50">




            <code class="ruby">      Rails.logger.error(&quot;Spotify API error: #{e.message}&quot;)</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="51">




            <code class="ruby">      raise e</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="52">




            <code class="ruby">    end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="53">




            <code class="ruby">  end</code>
          </li>
        </div>

        <div>
          <li class="missed" data-hits="0" data-linenumber="54">




            <code class="ruby">end</code>
          </li>
        </div>

    </ol>
  </pre>
</div>


      </div>
    </div>
  </body>
</html>
